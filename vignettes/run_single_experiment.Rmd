---
title: "Run DaNCES Simulations"
author: "Marina Papadopoulou"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{1 - Data Preparation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This vignette intends to guide the user through setting up a simulation experiment using a model built with the DaNCES software.

## Step 1. Repository set up

The `rDaNCES` package first defines a set of directories that will be used for keeping your repository tidy while running simulation experiments.
First, we need to define a name for our experiment and give the path to the folder that contains the executable (.exe) of our agent-based simulation:

```{r message=FALSE, warning=FALSE}

exp_name <- 'rdances_demo'
model_exe_path <- '..\\inst\\extdata\\sim_demo\\dances.exe'

```

The model executable should be in a separate folder in our working directory to be further used as the main repository for our simulations runs.
Most importantly, a template config (here named "demo_config.json") corresponding to the executable should be given: 

```{r message=FALSE, warning=FALSE}

main_repo <- dirname(model_exe_path)
config_tmp_name <- paste0(main_repo, '/demo_config.json')

```
The package uses these paths to set up a directory with the name of our experiment that contain the following: 

1. The 'generated_configs' subdirectory that will contain all the configuration files that cover the parameter space we go through with the experiment.
2. A log file with the text outputs of the simulations runs.
3. 


```{r message=FALSE, warning=FALSE}
library(rDaNCES)

dirs <- set_up_directories(sim_name = exp_name,
                           config_name = config_tmp_name,
                           model_exe = model_exe_path,
                           main_path =  main_repo
                           )

```

## Step 2. Parameter space set up

Now we can define which parameters we want to vary across our simulations, construct a parameter set, and set how many repetitions of each parameter combination we want:

```{r message=FALSE, warning=FALSE}

### Parameter values
N <- c(5, 10, 20) # group size
speed <- c(5, 10) # cruise speed of prey

# Number of repetitions of each parameter set:
reps <- 2

## Set up parameter combinations
param_set <- construct_ParamSets(
    N = N, 
    fl_aer_cs = speed, 
    output_folder = exp_name
  )
  
```

## Step 3. Simulation set up & run

Using our parameter set and directories, we can produce the new configuration files and run the simulations:

```{r message=FALSE, warning=FALSE}

## Create configuration files
set_up_simulations(param_set, dirs)

print(paste0('We will run ', length(list.files(dirs$EXP_CONFIGS_PATH)) * reps, ' simulations.'))

```
So when we are ready, we can run the simulations. The function will create a folder with the simulated data in the parent repository of the main folder:

```{r message=FALSE, warning=FALSE}
## Run all simulation
run_simulations(dirs, reps)

```